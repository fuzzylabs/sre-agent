# Docker Compose for SRE Agent and MCP server sidecars.
#
# Start with: docker compose up -d
# Logs: docker compose logs -f sre-agent

name: sre-agent

services:
  # SRE Agent (FastAPI)
  sre-agent:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      # LLM Provider
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - MODEL=${MODEL:-claude-sonnet-4-5-20250929}
      # AWS
      - AWS_REGION=${AWS_REGION}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_SESSION_TOKEN=${AWS_SESSION_TOKEN}
      # Slack MCP (SSE sidecar)
      - SLACK_CHANNEL_ID=${SLACK_CHANNEL_ID}
      - SLACK_MCP_URL=http://slack:13080/sse
      # GitHub MCP (Remote)
      - GITHUB_PERSONAL_ACCESS_TOKEN=${GITHUB_PERSONAL_ACCESS_TOKEN}
      - GITHUB_MCP_URL=https://api.githubcopilot.com/mcp/
    depends_on:
      slack:
        condition: service_started
    restart: unless-stopped

  # Slack MCP Server (korotovsky/slack-mcp-server)
  slack:
    image: ghcr.io/korotovsky/slack-mcp-server:latest
    environment:
      - SLACK_MCP_XOXB_TOKEN=${SLACK_BOT_TOKEN}
      - SLACK_MCP_ADD_MESSAGE_TOOL=${SLACK_CHANNEL_ID}
      - SLACK_MCP_HOST=0.0.0.0
      - SLACK_MCP_PORT=13080
    restart: unless-stopped
    ports:
      - "13080:13080"
